"use strict";var We=Object.create;var j=Object.defineProperty,Xe=Object.defineProperties,Ze=Object.getOwnPropertyDescriptor,et=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertyNames,ee=Object.getOwnPropertySymbols,rt=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var te=(a,e,t)=>e in a?j(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,m=(a,e)=>{for(var t in e||(e={}))re.call(e,t)&&te(a,t,e[t]);if(ee)for(var t of ee(e))at.call(e,t)&&te(a,t,e[t]);return a},y=(a,e)=>Xe(a,et(e));var i=(a,e)=>()=>(a&&(e=a(a=0)),e);var ot=(a,e)=>{for(var t in e)j(a,t,{get:e[t],enumerable:!0})},it=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of tt(e))!re.call(a,s)&&s!==t&&j(a,s,{get:()=>e[s],enumerable:!(r=Ze(e,s))||r.enumerable});return a};var $=(a,e,t)=>(t=a!=null?We(rt(a)):{},it(e||!a||!a.__esModule?j(t,"default",{value:a,enumerable:!0}):t,a));var o=(a,e,t)=>new Promise((r,s)=>{var n=h=>{try{L(t.next(h))}catch(q){s(q)}},d=h=>{try{L(t.throw(h))}catch(q){s(q)}},L=h=>h.done?r(h.value):Promise.resolve(h.value).then(n,d);L((t=t.apply(a,e)).next())});var ae,U,oe,ie,se,ne,ce,I,B=i(()=>{"use strict";require("dotenv").config();U=+((ae=process.env.PORT)!=null?ae:"9000"),I={host:(oe=process.env.MYSQL_HOST)!=null?oe:"localhost",port:(ie=process.env.MYSQL_PORT)!=null?ie:"3306",user:(se=process.env.MYSQL_USER)!=null?se:"admin",pass:(ne=process.env.MYSQL_PASS)!=null?ne:"",database:(ce=process.env.MYSQL_DATABASE)!=null?ce:""}});var pe,st,p,f=i(()=>{"use strict";pe=require("sequelize");B();st=new pe.Sequelize({dialect:"mysql",host:I.host,port:Number(I.port),username:I.user,password:I.pass,database:I.database,logging:!1,dialectOptions:{}}),p=st});var l,k,c,M=i(()=>{"use strict";l=require("sequelize");f();k=class extends l.Model{};k.init({id:{type:l.DataTypes.INTEGER,allowNull:!1,autoIncrement:!0,primaryKey:!0},name:{type:l.DataTypes.STRING,allowNull:!1},status:{type:l.DataTypes.STRING,allowNull:!1},species:{type:l.DataTypes.STRING,allowNull:!1},type:{type:l.DataTypes.STRING,allowNull:!0},gender:{type:l.DataTypes.STRING,allowNull:!1},comment:{type:l.DataTypes.STRING,allowNull:!0},image:{type:l.DataTypes.STRING,allowNull:!1}},{tableName:"character",sequelize:p,paranoid:!0,timestamps:!0});c=k});var C,P,u,D=i(()=>{"use strict";C=require("sequelize");f();P=class extends C.Model{};P.init({id:{type:C.DataTypes.INTEGER,allowNull:!1,autoIncrement:!0,primaryKey:!0},name:{type:C.DataTypes.STRING,allowNull:!1},type:{type:C.DataTypes.STRING,allowNull:!0},dimension:{type:C.DataTypes.STRING,allowNull:!1}},{tableName:"location",sequelize:p,paranoid:!0,timestamps:!0});u=P});var S,x,le,de=i(()=>{"use strict";M();D();S=require("sequelize");f();x=class extends S.Model{};x.init({id:{type:S.DataTypes.INTEGER,allowNull:!0,autoIncrement:!0,primaryKey:!0},characterId:{type:S.DataTypes.INTEGER,references:{model:c,key:"id"}},originId:{type:S.DataTypes.INTEGER,references:{model:u,key:"id"}}},{tableName:"characterorigin",sequelize:p,paranoid:!0,timestamps:!0});c.belongsToMany(u,{through:x});u.belongsToMany(c,{through:x});le=x});var E,v,me,ue=i(()=>{"use strict";M();D();E=require("sequelize");f();v=class extends E.Model{};v.init({id:{type:E.DataTypes.INTEGER,autoIncrement:!0,primaryKey:!0},characterId:{type:E.DataTypes.INTEGER,references:{model:c,key:"id"}},locationId:{type:E.DataTypes.INTEGER,references:{model:u,key:"id"}}},{tableName:"characterlocation",sequelize:p,paranoid:!0,timestamps:!0});c.belongsToMany(u,{through:v});u.belongsToMany(c,{through:v});me=v});var w,H,R,V=i(()=>{"use strict";w=require("sequelize");f();H=class extends w.Model{};H.init({id:{type:w.DataTypes.INTEGER,allowNull:!1,autoIncrement:!0,primaryKey:!0},name:{type:w.DataTypes.STRING,allowNull:!1},air_date:{type:w.DataTypes.STRING,allowNull:!1},episode:{type:w.DataTypes.STRING,allowNull:!1}},{tableName:"episode",sequelize:p,paranoid:!0,timestamps:!0});R=H});var A,N,he,ye=i(()=>{"use strict";M();V();A=require("sequelize");f();N=class extends A.Model{};N.init({id:{type:A.DataTypes.INTEGER,allowNull:!0,autoIncrement:!0,primaryKey:!0},characterId:{type:A.DataTypes.INTEGER,references:{model:c,key:"id"}},episodeId:{type:A.DataTypes.STRING,references:{model:R,key:"id"}}},{tableName:"characterepisode",sequelize:p,paranoid:!0,timestamps:!0});c.belongsToMany(R,{through:N});R.belongsToMany(c,{through:N});he=N});var b,W=i(()=>{"use strict";M();de();ue();ye();b=class{constructor(){}update(e,t){return o(this,null,function*(){try{let r={where:{id:e}};return(yield c.update(t,r))[0]>0?yield c.findByPk(e):0}catch(r){console.log(r)}})}find(e){return o(this,null,function*(){try{return(yield c.findAndCountAll(m({raw:!0},e))).rows}catch(t){console.log(t)}})}saveCharacter(e,t,r,s,n){return o(this,null,function*(){try{let d=yield c.findOrCreate({where:t,defaults:e});return r.id!=null&&(yield this.saveCharacterOrigin(t.id,r.id)),s.id!=null&&(yield this.saveCharacterLocation(t.id,s.id)),yield this.saveCharacterEpisode(t.id,n),d}catch(d){console.log(d)}})}saveCharacterOrigin(e,t){return o(this,null,function*(){try{return yield le.findOrCreate({where:{characterId:e,originId:t},defaults:{characterId:e,originId:t}})}catch(r){console.log(r)}})}saveCharacterLocation(e,t){return o(this,null,function*(){try{return yield me.findOrCreate({where:{characterId:e,locationId:t},defaults:{characterId:e,locationId:t}})}catch(r){console.log(r)}})}saveCharacterEpisode(e,t){return o(this,null,function*(){try{for(let r of t)yield he.findOrCreate({where:{characterId:e,episodeId:r.id},defaults:{characterId:e,episodeId:r.id}})}catch(r){console.log(r)}})}}});var Q,be,ge,Ce=i(()=>{"use strict";Q=require("express"),be=(0,Q.json)(),ge=(0,Q.urlencoded)({extended:!0})});var we,Ie,Se=i(()=>{"use strict";we=$(require("cors")),Ie=(0,we.default)({origin:"*",optionsSuccessStatus:200})});var xe=i(()=>{"use strict";Ce();Se()});var Ee,ve=i(()=>{"use strict";xe();Ee=a=>{a.use(Ie),a.use(be),a.use(ge)}});var Re,g,Ae=i(()=>{"use strict";Re=require("sequelize"),g=class{constructor(e){this.characterRepository=e;this.getCharacter=e=>{let t={};return t=e!=null&&e.page?y(m({},t),{limit:5,offset:(e.page-1)*5}):y(m({},t),{limit:5,offset:0}),e!=null&&e.order&&(t=e.order==0?y(m({},t),{order:[["name","ASC"]]}):y(m({},t),{order:[["name","DESC"]]})),this.characterRepository.find(t)};this.getCharacterFilter=e=>{let t={},r=e!=null&&e.filter?e==null?void 0:e.filter:"name";return t=e!=null&&e.page?y(m({},t),{limit:5,offset:(e.page-1)*5}):y(m({},t),{limit:5,offset:0}),t=y(m({},t),{where:{[r]:{[Re.Op.like]:`%${e==null?void 0:e.char}%`}}}),this.characterRepository.find(t)};this.updateCharacter=(e,t)=>this.characterRepository.update(e,t)}}});var Ne=i(()=>{"use strict";Ae()});var Oe=i(()=>{"use strict";Ne()});var Te=i(()=>{"use strict"});var Le=i(()=>{"use strict"});var qe=i(()=>{"use strict"});var Me=i(()=>{"use strict"});var Ge=i(()=>{"use strict";Te();Le();qe();Me()});var J,je=i(()=>{"use strict";J=class extends Error{constructor(e){super(),this.statusCode="5000",this.message="Error Internal the Server"}}});var ke=i(()=>{"use strict";je()});var Y,Pe=i(()=>{"use strict";Ge();ke();Y=a=>({statusCode:500,body:new J(a.stack)})});var T,De=i(()=>{"use strict";Pe();T=class{constructor(e){this.testService=e}get(e){return o(this,null,function*(){try{return yield this.testService.getCharacter(e)}catch(t){return Y(t)}})}getFilter(e){return o(this,null,function*(){try{return yield this.testService.getCharacterFilter(e)}catch(t){return Y(t)}})}update(e,t){return o(this,null,function*(){try{return yield this.testService.updateCharacter(e,t)}catch(r){return Y(r)}})}}});var G,He=i(()=>{"use strict";Oe();W();De();G=class{getCharacter(e){return o(this,null,function*(){let t=new b,r=new g(t);return yield new T(r).get(e)})}getCharacterFilter(e){return o(this,null,function*(){let t=new b,r=new g(t);return yield new T(r).getFilter(e)})}updateCharacter(e,t){return o(this,null,function*(){let r=new b,s=new g(r);return yield new T(s).update(e,t)})}}});var _e=i(()=>{"use strict";He()});var ze,Fe=i(()=>{"use strict";ze=`
type Episode {
    name: String
    episode: String
}

type Location {
    name: String
    type: String
    dimension: String
}

type Character {
    id: ID
    name: String
    status: String
    species: String
    type: String
    gender: String
    image: String
    comment: String
    episode: [Episode]
    location: Location
    origin: Location
    createdAt: String
    updatedAt: String
    deleteAt: String
}

type Query {
    character(page:ID, order:ID): [Character]
    characterFilter(page:ID, order:ID, filter:String, char:String): [Character]
}

type Mutation {
    updateCharacter(id:ID, comment:String):Character
}

`});var Ke,Qe,X,Je,Ye=i(()=>{"use strict";Ke=require("@apollo/server/express4"),Qe=require("@apollo/server");_e();Fe();X=new G,Je=a=>o(void 0,null,function*(){let e=new Qe.ApolloServer({typeDefs:ze,resolvers:{Query:{character:(t,r)=>o(void 0,null,function*(){return yield X.getCharacter(r)}),characterFilter:(t,r)=>o(void 0,null,function*(){return yield X.getCharacterFilter(r)})},Mutation:{updateCharacter:(t,r)=>o(void 0,null,function*(){let s={comment:r.comment};return yield X.updateCharacter(r.id,s)})}}});yield e.start(),a.use("/graphql",(0,Ke.expressMiddleware)(e))})});var Ue={};ot(Ue,{default:()=>nt});var $e,Z,nt,Be=i(()=>{"use strict";$e=$(require("express"));ve();Ye();Z=(0,$e.default)();Ee(Z);Je(Z);nt=Z});B();W();V();var _=class{constructor(){}saveEpisode(e,t){return o(this,null,function*(){try{return yield R.findOrCreate({where:t,defaults:e})}catch(r){console.log(r)}})}};D();var z=class{constructor(){}saveLocation(e,t){return o(this,null,function*(){try{return yield u.findOrCreate({where:t,defaults:e})}catch(r){console.log(r)}})}};var F=class{constructor(){this.getCharacter=e=>fetch("https://rickandmortyapi.com/graphql",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:`{characters(page: ${e}) {info {count pages} results { id name status species type gender image origin {id}  location {id}  episode{id}}}}`})}).then(t=>t.json()).then(t=>t);this.getLocation=e=>fetch("https://rickandmortyapi.com/graphql",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:`{locations (page: ${e}){
                info {
                  count
                  pages
                }
                results {
                  id
                  name
                  type
                  dimension
                }
              }}`})}).then(t=>t.json()).then(t=>t);this.getEpisode=e=>fetch("https://rickandmortyapi.com/graphql",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:`{episodes(page: ${e}) {
                info {
                  count
                  pages
                }
                results{
                  id
                  episode
                  name
                  air_date
                }
              }}`})}).then(t=>t.json()).then(t=>t)}};var fe=require("cron");var O=new F,K=class{constructor(){this.characterRepository=new b;this.episodeRepository=new _;this.locationRepository=new z;this.getCharacter=()=>o(this,null,function*(){yield this.saveEpisode(),yield this.saveLocation(),this.saveCharacter(),new fe.CronJob("0 0 12 * * *",()=>o(this,null,function*(){yield this.saveEpisode(),yield this.saveLocation(),this.saveCharacter()})).start()});this.saveEpisode=()=>o(this,null,function*(){let e=yield O.getEpisode(1),t=e.data.episodes.info.pages;for(let r=0;r<t;r++){let s=e.data.episodes.results;for(let n of s){let d=yield this.episodeRepository.saveEpisode(n,{id:n.id})}e=yield O.getEpisode(r+2)}});this.saveLocation=()=>o(this,null,function*(){let e=yield O.getLocation(1),t=e.data.locations.info.pages;for(let r=0;r<t;r++){let s=e.data.locations.results;for(let n of s){let d=yield this.locationRepository.saveLocation(n,{id:n.id})}e=yield O.getLocation(r+2)}});this.saveCharacter=()=>o(this,null,function*(){let e=yield O.getCharacter(1),t=e.data.characters.info.pages;for(let r=0;r<t;r++){let s=e.data.characters.results;for(let n of s){let d={id:n.id,name:n.name,status:n.status,species:n.species,type:n.type,gender:n.gender,image:n.image},L=n.origin,h=n.location,q=n.episode,lt=yield this.characterRepository.saveCharacter(d,{id:n.id},L,h,q)}e=yield O.getCharacter(r+2)}})}};f();var Ve=$(require("http"));var ct=new K;function pt(){return o(this,null,function*(){try{p.sync({alter:!0}),console.log("MySql loaded and connected! \u270C\uFE0F")}catch(t){console.error(t)}ct.getCharacter();let a=(yield Promise.resolve().then(()=>(Be(),Ue))).default;Ve.default.createServer(a).listen(U,()=>{console.log(`Example app listening on port ${U}`)})})}pt();
